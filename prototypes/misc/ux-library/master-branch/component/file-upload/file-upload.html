
<!--### File upload input
-->
<dom-module id="c-file-upload">
  <link rel="import" href="file-icon/file-icon.html"/>
  <link rel="import" href="../progress-bar/progress-bar.html"/>
  <link rel="import" href="variation-1.html"/>
  <template>
    <style>:host {
  display: inline-block;
  width: 100%;
  margin-bottom: -6px;
}
:host .upload-file-wrapper {
  position: relative;
  overflow: hidden;
  display: inline-block;
  padding: 0px;
}
:host .upload-file-wrapper .input-file-simple {
  display: none;
}
:host .upload-file-wrapper .form-group {
  margin: 0 20px;
}
:host .upload-file-wrapper .files-collection {
  max-height: 300px;
  overflow-y: auto;
  margin-top: 10px;
}
:host .upload-file-wrapper ::-webkit-scrollbar {
  width: 6px;
}
:host .upload-file-wrapper ::-webkit-scrollbar-thumb {
  background: #9c9c9c;
  border-radius: 4px;
}
:host .upload-file-wrapper ::-webkit-scrollbar-thumb:hover {
  background: #797979;
}
:host .upload-file-wrapper ::-webkit-scrollbar-track {
  background: #d8d8d8;
}
:host .upload-file-wrapper ::-webkit-scrollbar-track-piece {
  background: #d8d8d8;
}
:host .upload-file-wrapper .files-to-upload {
  font-weight: bold;
  margin: 15px 0 0 0;
}
:host .upload-file-wrapper .upload-info {
  margin-top: 20px;
}
:host #dropArea {
  max-width: 300px;
  background-color: #fff;
  text-align: center;
  padding: 20px;
  margin-top: 20px;
  border-radius: 24px;
  -webkit-border-radius: 24px;
  -moz-border-radius: 24px;
}
:host #dropArea .btn-mobile {
  margin-bottom: 15px;
}
:host #dropArea.highlight {
  background-color: #f0f0f0;
  color: #033a6a;
}
:host #dropArea p,
:host #dropArea h1 {
  text-align: center;
  padding-top: 0;
  margin-bottom: 0;
  color: inherit;
  font-size: 16px;
}
:host #dropArea .cloud-icon {
  font-size: 4rem;
  margin-bottom: 15px;
}
:host #dropArea .lead .text-info {
  font-weight: normal;
  font-size: 1em;
  cursor: pointer;
}
:host input[type="file"] {
  display: block;
  position: absolute;
  z-index: -1000;
  opacity: 0;
}
:host label.btn {
  color: #033a6a;
}
:host .file-list {
  border-bottom: 1px solid #ececec;
  padding: 8px 0;
  display: flex;
  flex-direction: row;
  flex-flow: row wrap;
}
:host .file-list .pb-wrapper {
  flex: 1 100%;
  margin-top: 10px;
  margin-bottom: -28px;
}
:host .file-list .file-icon.done {
  opacity: 0.4;
}
:host .pb-wrapper {
  opacity: 1;
  transition: all 0.8s 1s;
}
:host .action-btn-wrapper {
  padding: 15px;
  box-shadow: 0px -4px 16px rgba(0, 0, 0, 0.08);
}
:host .upload-file-wrapper.inline #dropArea,
:host .upload-file-wrapper.inline .upload-info,
:host .upload-file-wrapper.inline .files-collection,
:host .upload-file-wrapper.inline .fileerror,
:host .upload-file-wrapper.inline .files-to-upload,
:host .upload-file-wrapper.inline .action-btn-wrapper {
  display: none;
}
:host .upload-file-wrapper.inline .pb-wrapper {
  width: 100%;
  position: absolute;
  left: 0;
  bottom: 0px;
  z-index: 2;
  height: 6px;
  overflow: hidden;
}
:host .upload-file-wrapper.inline .input-file-simple {
  display: table;
}
:host .upload-file-wrapper.inline .input-file-simple input[type="text"] {
  cursor: pointer;
  color: transparent;
  text-shadow: 0 0 0 #53565a;
}
:host .upload-file-wrapper.inline .input-file-simple input[disabled="disabled"] {
  cursor: not-allowed;
}
:host .upload-file-wrapper.inline .input-file-simple .input-group-btn {
  z-index: 1;
}
:host .upload-file-wrapper.inline .input-file-simple i {
  position: absolute;
  top: 14px;
  right: 15px;
  z-index: 2;
  cursor: pointer;
}
:host .file-meta {
  flex-grow: 2;
  padding-left: 20px;
  position: relative;
}
:host .file-meta p {
  margin: 0;
  padding: 0;
  text-align: left;
}
:host .file-meta .file-size {
  color: #94999d;
}
:host .file-meta .file-status-icon {
  position: absolute;
  right: 10px;
  top: 15px;
  font-size: 1.3em;
}
:host .file-meta .fa-times {
  cursor: pointer;
}
:host .file-meta .fa-check {
  display: none;
}
:host .file-meta .fa-spinner {
  color: #033a6a;
  display: none;
}
:host .file-meta.uploading .fa-times {
  display: none;
}
:host .file-meta.uploading .fa-spinner {
  display: block;
  animation: rotate 1s infinite forwards;
}
:host .done .file-meta .fa-spinner {
  display: none;
}
:host .done .file-meta .fa-times {
  display: none;
}
:host .done .file-meta .fa-check {
  color: #44a878;
  display: block;
}
:host .done .file-icon,
:host .done p {
  opacity: 0.4;
}
:host .done .pb-wrapper {
  opacity: 0;
  margin-bottom: -42px;
}
:host .upload-file-wrapper.inline .done .pb-wrapper {
  margin-bottom: 0px;
}
@keyframes rotate {
  0% {
    transform: rotate(0deg);
  }
  100% {
    transform: rotate(360deg);
  }
}
@media (min-width: 992px) {
  #dropArea .btn-mobile {
    display: none;
  }
}
@media (max-width: 991px) {
  #dropArea > p {
    display: none;
  }
  #dropArea .btn-mobile {
    display: inline-block;
  }
}

    </style><div class$="upload-file-wrapper col-xs-12 {{display}}">

      <div id="simpleInput" class="input-group input-file-simple">
          <input type="text" class="form-control" on-click="clickFileInput" placeholder="Select file" value="{{simpleInputVal}}">
          <div class="file-meta">
            <i class="fal fa-times" on-click="resetInput"></i>
            <i class="fal fa-check"></i>
            <i class="fal fa-spinner"></i>
          </div>
          <div class="pb-wrapper">
            <c-progress-bar value="0" context="success" class="hidden"></c-progress-bar>
          </div>
          <span class="input-group-btn">
            <button class$="btn btn-default {{disableSimpleBtn}}" type="button" on-click="uploadFiles">Upload</button>
          </span>
      </div>
      <!-- /input-group -->
      <div id="dropArea" class="form-group" hidden$="{{!showDropArea}}"
          on-dragenter="allowDrop" on-dragover="allowDrop"
          on-drop="dropFile"
          on-dragleave="removeHighlight" on-dragexit="removeHighlight">
        <p class="cloud-icon"><i class="fal fa-cloud-upload"></i></p>
        <p class="lead">
          Drag & drop here
          <label class="text-info">
            or browse
            <input type="file" name={{name}} on-change="handleChange" multiple$={{multiple}} accept$="{{accept}}" required$={{required}}>
          </label>
        </p>
        <p>to upload your files</p>
        <label on-click="clickFileInput" class="btn-mobile btn btn-default">Select file</label>
      </div>
      <div class="upload-info form-group">
        <p>
        <template is="dom-if" if="{{maxFileSize}}">
          {{fileLimitInfo}}
        </template>
        <br>
        <template is="dom-if" if="{{accept}}">
          {{fileAcceptInfo}}
        </template>
        </p>
      </div>
      <div id="fileerror" class="has-warning"></div>

      <p class="files-to-upload" hidden$={{!isFiles}}>File(s) to upload</p>
      <div class="files-collection scroll-y">
        <template is="dom-repeat" items={{files}} sort="sortFilenames">
          <div id="setPb{{item.id}}" class="form-group row file-list" hidden$={{item.fileSizeStatus}}>
            <div class="file-icon">
              <file-icon filename="{{item.name}}"></file-icon>
            </div>
            <div class="file-meta">
              <p class="file-name"><strong>{{item.name}}</strong></p>
              <p class="file-size">{{item.fileSize}}</p>
              <div class="file-status-icon">
                <i class="fal fa-check"></i>
                <i class="fal fa-spinner"></i>
                <i id="{{item.id}}" class="fal fa-times" on-click="removeFile"></i>
              </div>
            </div>
            <div class="pb-wrapper">
              <c-progress-bar value="0" context="success" class="hidden"></c-progress-bar>
            </div>
          </div>
        </template>
      </div>

      <div class="action-btn-wrapper" hidden$={{!isFiles}}>
        <div class="buttons">
          <span><button type="button" name="button" class="btn btn-sm btn-primary" on-click="uploadFiles">{{uploadBtnText}}</button></span>
        </div>
      </div>

</div>

  </template>
  <script>var name = 'c-file-upload';!function(e){var i={};function t(l){if(i[l])return i[l].exports;var s=i[l]={i:l,l:!1,exports:{}};return e[l].call(s.exports,s,s.exports,t),s.l=!0,s.exports}t.m=e,t.c=i,t.d=function(e,i,l){t.o(e,i)||Object.defineProperty(e,i,{enumerable:!0,get:l})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,i){if(1&i&&(e=t(e)),8&i)return e;if(4&i&&"object"==typeof e&&e&&e.__esModule)return e;var l=Object.create(null);if(t.r(l),Object.defineProperty(l,"default",{enumerable:!0,value:e}),2&i&&"string"!=typeof e)for(var s in e)t.d(l,s,function(i){return e[i]}.bind(null,s));return l},t.n=function(e){var i=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(i,"a",i),i},t.o=function(e,i){return Object.prototype.hasOwnProperty.call(e,i)},t.p="",t(t.s=15)}({15:function(e,i){Polymer({is:name,properties:{fullbleed:{type:Boolean,value:!0},accept:{type:String},display:{type:String},disableSimpleBtn:{type:String,value:"disabled"},errorTitle:{type:String},files:{type:Array,value:function(){return[]}},filesUploaded:{type:Array,value:function(){return[]}},fileLimitInfo:{type:String},fileAcceptInfo:{type:String},fileId:{type:Number,value:0},handleChangeFired:{type:Boolean},isFiles:{type:Boolean,value:!1},maxFileSize:{type:Number},multiple:{type:Boolean,value:!1},name:{type:String},showDropArea:{type:Boolean,value:!0},simpleInputVal:{type:String,value:""},totalFileUpload:{type:Number},totalProgress:{type:Number,value:0},uploadBtnText:{type:String}},ready:function(){this.maxFileSize&&(this.fileLimitInfo="Maximum file size "+this.maxFileSize+"KB"),this.accept&&(this.fileAcceptInfo="Only "+this.accept+" files are allowed")},addFiles:function(e){Array.prototype.forEach.call(e,this.addFile.bind(this)),1==e.length?this.simpleInputVal=e[0].name:this.simpleInputVal=this.files.length+" files",this.updateIsFiles()},addFile:function(e){var i,t,l,s;if(!this.isFileExist(e))if(t=e.name.match(/\.[^\.]*$|$/)[0],e.extension=t,i=!!this.maxFileSize&&1==this.updateFileSizeInfo(e.size),s=!this.accept||((l=new RegExp("^("+this.accept.replace(/[, ]+/g,"|").replace(/\/\*/g,"/.*")+")$","i")).test(e.type)||l.test(t)),i||!s){i&&(e.fileErrorMessage="Size exceeds permissible upload limit"),s||(e.fileErrorMessage="File type not allowed");var n=document.createElement("p");n.innerHTML=e.name+"- "+this.calcFileSize(e.size)+" - "+e.fileErrorMessage,n.classList.add("help-block"),Polymer.dom(this.$.fileerror).appendChild(n),Polymer.dom(this.$.fileerror).classList.remove("hidden")}else e.id=this.fileId,e.fileSize=this.calcFileSize(e.size),this.unshift("files",e),this.fileId++},allowDrop:function(e){e.preventDefault(),Polymer.dom(this.$.dropArea).classList.add("highlight"),e.dataTransfer.dropEffect="move"},calcFileSize:function(e){return e<1024?e+"bytes":e>=1024&&e<1048576?(e/1024).toFixed(1)+"KB":e>=1048576?(e/1048576).toFixed(1)+"MB":void 0},clickFileInput:function(e){Polymer.dom(this.root).querySelector('input[name="'+this.name+'"]').click()},dropFile:function(e){e.preventDefault(),this.removeHighlight();var i=e.dataTransfer,t=i.files.length;this.multiple?(Polymer.dom(this.root).querySelector('input[name="'+this.name+'"]').files=i.files,this.handleChangeFired||this.addFiles(i.files)):1==t?(this.files.length>0&&(this.files=[]),Polymer.dom(this.root).querySelector('input[name="'+this.name+'"]').files=i.files,this.handleChangeFired||this.addFiles(i.files)):(e.dataTransfer.clearData(),this.errorTitle="No multiple files allowed")},handleChange:function(e){this.handleChangeFired=!0,0!=this.multiple&&"inline"!=this.display||(this.files=[]),this.addFiles(e.srcElement.files)},isFileExist:function(e){for(var i=!1,t=0;t<this.files.length;t++)this.files[t].name==e.name&&this.files[t].size==e.size&&(i=!0);if(this.filesUploaded.length>0)for(var l=0;l<this.filesUploaded.length;l++)this.filesUploaded[l].name==e.name&&this.filesUploaded[l].size==e.size&&(i=!0);return i},removeHighlight:function(){Polymer.dom(this.$.dropArea).classList.remove("highlight")},removeFile:function(e){var i=e.target.id,t="#setPb"+i;this.$$(t).parentNode.removeChild(this.$$(t));for(var l=0;l<this.files.length;l++)this.files[l].id==i&&this.splice("files",l,1);this.updateIsFiles(),this.isFiles||0!=this.filesUploaded.length||(Polymer.dom(this.root).querySelector('input[name="'+this.name+'"]').value=null)},resetInput:function(){this.simpleInputVal="",this.files=[],Polymer.dom(this.root).querySelector('input[name="'+this.name+'"]').value=null,this.updateIsFiles()},setProgressBarValue:function(e,i){var t,l;"inline"==this.display?(t="#simpleInput",l=(this.totalProgress+i)/this.totalFileUpload*100):(t="#setPb"+e.id,l=i,this.uploadBtnText="Uploading... ",this.$$(t).querySelector(".file-size").innerHTML="Uploading..."),0==l&&this.$$(t).querySelector("c-progress-bar").classList.remove("hidden"),this.$$(t).querySelector("c-progress-bar").setAttribute("value",l),this.$$(t).querySelector(".file-meta").classList.add("uploading"),100==i&&(this.totalProgress+=i,this.uploadFileDone(e),"inline"!=this.display&&(this.$$(t).classList.add("done"),this.$$(t).querySelector(".file-size").innerHTML="Uploaded")),100==l&&(this.$$(t).classList.add("done"),this.uploadFilesDone(),"inline"==this.display&&(this.simpleInputVal="Files uploaded",this.$$(t).querySelector('input[type="text"]').setAttribute("disabled","disabled")))},sortFilenames:function(e,i){var t=e.id,l=i.id;return t<l?-1:t>l?1:0},updateFileSizeInfo:function(e){return e>1024*this.maxFileSize},updateIsFiles:function(){this.uploadBtnText="Upload "+this.files.length+(1==this.files.length?" file":" files"),0==this.files.length?(this.simpleInputVal="",this.disableSimpleBtn="disabled"):this.disableSimpleBtn="",this.isFiles=0!=this.files.length},uploadFiles:function(e){var i={files:this.files,name:this.name},t=new CustomEvent("uploadFiles",{detail:i});document.dispatchEvent(t),this.totalFileUpload=100*this.files.length,this.totalProgress=0},uploadFileDone:function(e){var i=this.files.map(function(e){return e.id}).indexOf(e.id);this.files.splice(i,1),this.unshift("filesUploaded",e),this.updateIsFiles()},uploadFilesDone:function(){this.multiple||(this.showDropArea=!1)}})}});
  </script>
  <script>
    if(window['params'].monitoring){
      ga('send', {
        hitType: 'event',
        eventCategory: 'corporate-ui-component', //the object that user interact with on the page
        eventAction: 'loaded', // type of interaction with the object
        eventLabel: 'c-file-upload'  //categorizing events
      },{
        nonInteraction: true
      });
    }
  </script>
</dom-module>
